---
import AchievementsList from '/src/components/AchievementsList';
import AlchemistryAchievementDescription from '/src/components/AlchemistryAchievementDescription';

import Layout from '/src/layout/layout.astro';

import { achievements } from '/src/business/alchemistry_achievementManager.js';
import { APP_ID } from '/src/business/alchemistry_constants.js';
import getAchievementsPercentagesForGame from '/src/business/getAchievementsPercentagesForGame.js';

import { getLangFromUrl, useTranslations } from '/src/i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const achievementsPercentages = await getAchievementsPercentagesForGame(APP_ID);

if(achievementsPercentages.length !== Object.keys(achievements).length) {
	throw new Error('There are some missing achievements to generate the wiki');
}

const achievementsToDisplay = achievementsPercentages.map((achievementData) => {
	const achievement = {
		name: achievementData.name,
		index: Object.keys(achievements).indexOf(achievementData.name),
		percent: achievementData.percent
	};
	achievement.description = AlchemistryAchievementDescription({ t, achievement });

	return achievement;
});
---
<Layout title="Alchemistry - Achievements">
	<AchievementsList t={t} achievements={achievementsToDisplay} />
</Layout>
